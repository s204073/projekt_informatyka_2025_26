#include <iostream>
#include <vector>
#include <algorithm>
#include <optional>
#include <SFML/Graphics.hpp>
#include "Paddle.h"
#include "Ball.h"
#include "Brick.h"	

int main() {
	const int SZEROKOSC = 800;
	const int WYSOKOSC = 600;
	sf::RenderWindow window(sf::VideoMode(SZEROKOSC, WYSOKOSC), "Arcystonid - super gra polecam z rodzinka");	//buduje okno
	window.setFramerateLimit(60);		//ustawia klatki na sekunde i nizej zegar
	sf::Clock deltaClock;

	//towrzenie obiektow gry
	Paddle paletka({ SZEROKOSC / 2.f, WYSOKOSC - 30.f }, { 200.f, 20.f }, { 400.f, 0.f });
	Ball pilka({ SZEROKOSC / 2.f, WYSOKOSC / 2.f }, 20.f, { -300.f, -300.f });

	//tworzenie cegielek
	std::vector<Brick> bloki;

	const int ILOSC_KOLUMN = 12;	//wlasciwy poziom blokow
	const int ILOSC_WIERSZY = 4;
	float ROZMIAR_BLOKU_X = (SZEROKOSC - (ILOSC_KOLUMN - 1) * 2.f) / ILOSC_KOLUMN;
	float ROZMIAR_BLOKU_Y = 20.f;

	//rysowanie blokow
	for (int y = 0; y < ILOSC_WIERSZY; y++) {
		for (int x = 0; x < ILOSC_KOLUMN; x++) {
			float posX = x * (ROZMIAR_BLOKU_X + 2.f); //przewraw miedzy blokami 2px
			float posY = y * (ROZMIAR_BLOKU_Y + 2.f) + 60.f;
			//kolor bloku - ilosc zyc
			int zycie = 0;
			if (y == 0)
				zycie = 1;
			if (y >= 1)
				zycie = 2;

			bloki.emplace_back(sf::Vector2f(posX, posY), sf::Vector2f(ROZMIAR_BLOKU_X, ROZMIAR_BLOKU_Y), zycie);
		}
	}

	//petla glowna

	while (window.isOpen()) {
		sf::Time dt = deltaClock.restart();   //pobierz czas i zrestartuj zegar
		sf::Event event;

		while (window.pollEvent(event)) {
			if (event.type == sf::Event::Closed)
				window.close();
		}

		//aktualizacja logiki
		paletka.ruch(dt, SZEROKOSC);
		pilka.ruch(dt, { SZEROKOSC, WYSOKOSC }, paletka);

		//kolizja pilki z blokami
		for (auto& blk : bloki) {
			if (!blk.czyZniszczony() && pilka.getGlobalBounds().intersects(blk.getGlobalBounds())) {
				blk.trafienie(); //zmiana kolorwu
				pilka.odbijY(); //odbcie duh
			}
		}

		//usuwanie zniszczonych blokow
		//iterowanie od konca wektora (i=bloki.size()-1; i>=0; i--)
		for (int i = bloki.size() - 1; i >= 0; i--) {
			if (bloki[i].czyZniszczony()) {
				bloki.erase(bloki.begin() + i);
			}
		}

		//rysowanie
		window.clear(sf::Color(40, 30, 20));
		paletka.draw(window);
		pilka.draw(window);

		//bloki rysowanie
		for (auto& blk : bloki) {
			blk.draw(window);
		}

		window.display();
	}
}




